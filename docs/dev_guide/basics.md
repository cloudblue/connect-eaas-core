## Events and tasks

Events are delivered to extensions as `Tasks`. Each extension incorporates its own `tasks queue` for specifying events that should be processed.

There are three different categories of `Tasks`:

* **Background:** These tasks are generated when a change to a domain object occurs (e.g.,
    a `purchase request` is created or has been `approved`);
* **Interactive:** Such tasks are created by a web call (for example a `draft purchase request validation` or
    a `product action`);
* **Scheduled:** These tasks are created and triggered according to a schedule that is configured for your extension.

Note that the way your extension processes a `tasks queue` depends on a task category and your extension type.

### Background tasks

The following outlines rules that apply to background tasks:

* For `Fulfillment Automation` extensions: an event generates a task only in case its associated domain object is related to a *Product* that is selected for your extension.
* For `Hub Integration` extensions: an event generates a task only if a domain object is related to a *Hub* that is selected for your extension.
* For `Multi Account Installation` extensions: an event generates a task only in case a domain object is visible to an account that installed such an extension.
* In case a `task` for a given domain object is in a queue (i.e., it has the `scheduled` status) and this object is changed, additional tasks will not be created.
* If a `task` is rescheduled by the extension (i.e., your extension will process a task after a few seconds), this task will be delivered once this delay is expired.

### Interactive tasks

Events that generate interactive tasks are only available for `Fulfillment Automation` extensions.
Due to their nature, they are delivered immediately.

### Scheduled tasks


When a schedule configured for an extension is triggered, it generates a task that is related to this schedule. In case a task for the same schedule is in a queue and this schedule is triggered again, additional tasks will not be created.


Most of domain objects on CloudBlue Connect will generate an event every time they change.

### Events subscription

An extension can receive events generated by a certain type of domain object via a list of object states. Therefore, once your selected object switches to your specified state, your extension can receive this event and perform subsequent operaions.

For example, an extension can be assigned to receive only those events when `purchase requests` are switched to the `approved` state.  



## Project folder structure

The quickest way to build an extension project is by using the [CloudBlue Connect CLI](https://github.com/cloudblue/connect-cli).

Open your terminal and use the following command to bootstrap a new extension project:

```
$ ccli project extension bootstrap
```

This command will launch a wizard that will help configure your extension:

![Boostrap project](../images/cli/bootstrap_project.png)


Once this wizard finalizes the bootstrap operation, a directory with the following structure will be created:

```
.
└── <project_root>
    ├── <package_name>
    │   ├── __init__.py
    │   ├── anvil.py
    │   ├── events.py
    │   ├── extension.json
    │   ├── schemas.py
    │   ├── static
    │   └── webapp.py
    ├── CHANGELOG.md
    ├── Dockerfile
    ├── HOWTO.md
    ├── LICENSE
    ├── README.md
    ├── __mocks__
    │   ├── fileMock.js
    │   └── styleMock.js
    ├── babel.config.json
    ├── docker-compose.yml
    ├── jest.config.js
    ├── package.json
    ├── poetry.toml
    ├── pyproject.toml
    ├── tests
    │   ├── __init__.py
    │   ├── conftest.py
    │   ├── test_anvil.py
    │   ├── test_events.py
    │   └── test_webapp.py
    ├── ui
    │   ├── pages
    │   │   ├── index.html
    │   │   └── settings.html
    │   ├── src
    │   │   ├── components.js
    │   │   ├── pages
    │   │   │   ├── index.js
    │   │   │   └── settings.js
    │   │   ├── pages.js
    │   │   └── utils.js
    │   ├── styles
    │   │   └── index.css
    │   └── tests
    │       ├── components.spec.js
    │       ├── pages.spec.js
    │       └── utils.spec.js
    └── webpack.config.js
```

The following describes the content of your generated project root folder:

* **README.md**: This file is intended to provide a description of your extension project. It is
    used by the `pyproject.toml` file to add a description to your python package and will also be renderered on
    the main page of your git repository in various git hosting services.
* **CHANGELOG.md**: This file is used to track changes between versions of your extension.
    In case your `Multi Account Installation` extension is published in the Connect Showroom Catalog, your changelog will also be rendered in the Catalog.
* **HOWTO.md**: Provides useful information about basic tasks related to the development of your extension.
* **LICENSE**: This file represents your specified agreement of the open-source licence for releasing your extension.
* **poetry.toml**: This file is used to disable the creation of a Python virtual environment when using Poetry. The creation of a
    virtual environment is disabled since extensions are developed inside a docker container by default.
* **.gitignore**: A default file that helps avoid commiting unsupported files within the git repository, such as `pyc` files, 
    `coverage.xml` and so on.

The `Connect CLI` can also be used to deploy your extension project. Note that your extension can be deployed in the *Cloud* mode and hosted on a git server accesible through the internet, hence the presence of a `.git` directory.

!!! info
    * Applications are stateless
    * UI is served by a blob storage for cloud mode
