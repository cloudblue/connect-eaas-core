## Events and tasks

Events are delivered to extensions as `Tasks`. Each extension has its own `Tasks` queue from which it takes the next event that have
to be processed.

There are three different categories of `Tasks`:

* **background:** this category groups tasks generated when a change to a domain object is persisted for example
    a `purchase request` is created or has been `approved`;
* **interactive:** this category groups tasks generated by a web call for example a `draft purchase request validation` or
    a `product action`;
* **scheduled:** this category will groups tasks created when a schedule that have been configured for you extension triggers.


The way the `Tasks` queue is processed depends on the task category and the extension type.

### Background tasks

The following rules apply to background tasks:

* For `Fulfillment Automation` extensions an event generates a task only if the domain object that triggered the event is related to one of the products choosed for such extension.
* For `Hub Integration` extensions an event generates a task only if the domain object that triggered the event is related to the Hub choosed for such extension.
* For `Multi Account Installation` extensions an event generates a task only if the domain object is visible by an account that installed such extension.
* If a `Task` for a given domain object is in the queue waiting for being processed (i.e. it has the `scheduled` status) no more tasks
for the same object will be created if such object changes.
* If a `Task` has been rescheduled by the extension (the extension decided to process after a certain amount of seconds) this task will be delivered only after the delay has been expired.

### Interactive tasks

Events that generate interactive tasks are only available for `Fulfillment Automation` extensions.
Due to their nature, they are delivered immediately.

### Scheduled tasks

When a schedule configured for an extension triggers, it generate a task related to such schedule. If a task for the same schedule is waiting in the queue, no more tasks are created if the schedule triggers again.


Most of the domain objects of CloudBlue Connect will generate an event every time they change.



`Tasks` are grouped within the following categories:

    


An extension can subscribe to receive events generated by a certain type of domain object by specifying a list of object states in which the extension is interested.

For example, an extension can be interested in the events generated by a `purchase request` only when it reaches the `approved` status.




## Project folder structure

The easiest way to start an extension project is using the CloudBlue [Connect CLI](https://github.com/cloudblue/connect-cli).

To bootstrap the project open a terminal and run:

```
$ ccli project extension bootstrap
```

This command runs a wizard that will guide you through the creation of an extension project:

![Boostrap project](../images/dev_guide/bootstrap_project.png)


Oonce the wizard is finished, depending on the answers you have given, the following directory structure will be created:

```
.
└── <project_root>
    ├── <package_name>
    │   ├── __init__.py
    │   ├── anvil.py
    │   ├── events.py
    │   ├── extension.json
    │   ├── schemas.py
    │   ├── static
    │   └── webapp.py
    ├── CHANGELOG.md
    ├── Dockerfile
    ├── HOWTO.md
    ├── LICENSE
    ├── README.md
    ├── __mocks__
    │   ├── fileMock.js
    │   └── styleMock.js
    ├── babel.config.json
    ├── docker-compose.yml
    ├── jest.config.js
    ├── package.json
    ├── poetry.toml
    ├── pyproject.toml
    ├── tests
    │   ├── __init__.py
    │   ├── conftest.py
    │   ├── test_anvil.py
    │   ├── test_events.py
    │   └── test_webapp.py
    ├── ui
    │   ├── pages
    │   │   ├── index.html
    │   │   └── settings.html
    │   ├── src
    │   │   ├── components.js
    │   │   ├── pages
    │   │   │   ├── index.js
    │   │   │   └── settings.js
    │   │   ├── pages.js
    │   │   └── utils.js
    │   ├── styles
    │   │   └── index.css
    │   └── tests
    │       ├── components.spec.js
    │       ├── pages.spec.js
    │       └── utils.spec.js
    └── webpack.config.js
```

First of all let's analyze the python package.

Inside it you will find the following python modules:

* **anvil.py:** this file will be present if you choosed to implements an `Anvil Application` in your extension and will contain the anvil application class
* **events.py:** this file will be present if you choosed to implements an `Events Application` in your extension and will contain the events application class with an event handler for each event you selected during the wizard. It will also contain an example handler
for scheduled execution.


* Applications are stateless
* UI is served by a blob storage for cloud mode
